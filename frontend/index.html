<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mosaic Agent - Infrastructure Platform</title>
    
    <!-- Security headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss:;">
    
    <!-- React and React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios for HTTP requests -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- Lucide React icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f8fafc;
        }
        
        .mosaic-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .mosaic-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .mosaic-content {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .mosaic-sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #e2e8f0;
            box-shadow: 2px 0 4px rgba(0,0,0,0.05);
        }
        
        .mosaic-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }
        
        .mosaic-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .mosaic-tab {
            padding: 1rem 2rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .mosaic-tab.active {
            border-bottom-color: #667eea;
            background: #f8fafc;
        }
        
        .mosaic-tab:hover {
            background: #f1f5f9;
        }
        
        .mosaic-panel {
            flex: 1;
            overflow: hidden;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online { background-color: #10b981; }
        .status-offline { background-color: #ef4444; }
        .status-warning { background-color: #f59e0b; }
        
        /* Loading animation */
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .mosaic-content {
                flex-direction: column;
            }
            
            .mosaic-sidebar {
                width: 100%;
                height: 200px;
            }
            
            .mosaic-tabs {
                overflow-x: auto;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Main application component
        const MosaicAgentApp = () => {
            const [activeTab, setActiveTab] = useState('files');
            const [systemStatus, setSystemStatus] = useState(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                checkSystemHealth();
                const interval = setInterval(checkSystemHealth, 30000); // Check every 30 seconds
                return () => clearInterval(interval);
            }, []);
            
            const checkSystemHealth = async () => {
                try {
                    const response = await axios.get('/health');
                    setSystemStatus(response.data);
                } catch (error) {
                    console.error('Health check failed:', error);
                    setSystemStatus({ status: 'error', error: error.message });
                } finally {
                    setLoading(false);
                }
            };
            
            const getStatusColor = (status) => {
                switch (status) {
                    case 'ok': return 'status-online';
                    case 'error': return 'status-offline';
                    default: return 'status-warning';
                }
            };
            
            return (
                <div className="mosaic-container">
                    {/* Header */}
                    <div className="mosaic-header">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center">
                                <h1 className="text-2xl font-bold mr-4">ü§ñ Mosaic Agent</h1>
                                <span className="text-lg opacity-90">Infrastructure Platform</span>
                            </div>
                            
                            <div className="flex items-center space-x-4">
                                {loading ? (
                                    <span className="text-sm opacity-75">Checking status...</span>
                                ) : systemStatus ? (
                                    <div className="flex items-center">
                                        <span className={`status-indicator ${getStatusColor(systemStatus.status)}`}></span>
                                        <span className="text-sm">
                                            {systemStatus.status === 'ok' ? 'System Online' : 'System Error'}
                                        </span>
                                    </div>
                                ) : null}
                                
                                <div className="text-sm opacity-75">
                                    v{systemStatus?.version || '1.0.0'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Content */}
                    <div className="mosaic-content">
                        {/* Sidebar */}
                        <div className="mosaic-sidebar">
                            <div className="p-4">
                                <h3 className="font-semibold text-gray-800 mb-4">System Status</h3>
                                
                                {loading ? (
                                    <div className="loading-spinner"></div>
                                ) : systemStatus ? (
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span className="text-sm text-gray-600">Status:</span>
                                            <span className={`text-sm font-medium ${systemStatus.status === 'ok' ? 'text-green-600' : 'text-red-600'}`}>
                                                {systemStatus.status}
                                            </span>
                                        </div>
                                        
                                        <div className="flex justify-between">
                                            <span className="text-sm text-gray-600">Uptime:</span>
                                            <span className="text-sm">
                                                {Math.floor(systemStatus.uptime / 3600)}h {Math.floor((systemStatus.uptime % 3600) / 60)}m
                                            </span>
                                        </div>
                                        
                                        {systemStatus.services && (
                                            <div className="mt-4">
                                                <h4 className="text-sm font-medium text-gray-700 mb-2">Services</h4>
                                                {Object.entries(systemStatus.services).map(([service, status]) => (
                                                    <div key={service} className="flex justify-between mb-1">
                                                        <span className="text-xs text-gray-600 capitalize">{service}:</span>
                                                        <span className={`text-xs ${status === 'enabled' || status === 'running' ? 'text-green-600' : 'text-yellow-600'}`}>
                                                            {status}
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="text-sm text-red-600">Failed to load status</div>
                                )}
                                
                                <div className="mt-6 pt-4 border-t border-gray-200">
                                    <h4 className="text-sm font-medium text-gray-700 mb-2">Quick Actions</h4>
                                    <div className="space-y-2">
                                        <button 
                                            onClick={() => checkSystemHealth()}
                                            className="w-full text-left text-sm text-blue-600 hover:text-blue-800 py-1"
                                        >
                                            üîÑ Refresh Status
                                        </button>
                                        <button 
                                            onClick={() => window.open('/health', '_blank')}
                                            className="w-full text-left text-sm text-blue-600 hover:text-blue-800 py-1"
                                        >
                                            ü©∫ Health Check
                                        </button>
                                        <button 
                                            onClick={() => window.open('/api/security/policies', '_blank')}
                                            className="w-full text-left text-sm text-blue-600 hover:text-blue-800 py-1"
                                        >
                                            üîí Security Policies
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Main Content */}
                        <div className="mosaic-main">
                            {/* Tabs */}
                            <div className="mosaic-tabs">
                                <div 
                                    className={`mosaic-tab ${activeTab === 'files' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('files')}
                                >
                                    üìÅ File Manager
                                </div>
                                <div 
                                    className={`mosaic-tab ${activeTab === 'terminal' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('terminal')}
                                >
                                    üíª Terminal
                                </div>
                                <div 
                                    className={`mosaic-tab ${activeTab === 'agents' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('agents')}
                                >
                                    ü§ñ Agent Workflow
                                </div>
                                <div 
                                    className={`mosaic-tab ${activeTab === 'security' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('security')}
                                >
                                    üîí Security
                                </div>
                            </div>
                            
                            {/* Panel Content */}
                            <div className="mosaic-panel">
                                {activeTab === 'files' && <FileManagerPanel />}
                                {activeTab === 'terminal' && <TerminalPanel />}
                                {activeTab === 'agents' && <AgentWorkflowPanel />}
                                {activeTab === 'security' && <SecurityPanel />}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Placeholder components for each panel
        const FileManagerPanel = () => (
            <div className="p-6 h-full">
                <h2 className="text-xl font-bold mb-4">üìÅ File Manager</h2>
                <div className="bg-white rounded-lg shadow p-6 h-full">
                    <div className="flex items-center justify-center h-64 border-2 border-dashed border-gray-300 rounded-lg">
                        <div className="text-center">
                            <p className="text-gray-500 mb-2">File Manager component will be loaded here</p>
                            <p className="text-sm text-gray-400">Upload, navigate, and preview files</p>
                        </div>
                    </div>
                </div>
            </div>
        );
        
        const TerminalPanel = () => (
            <div className="p-6 h-full">
                <h2 className="text-xl font-bold mb-4">üíª Terminal</h2>
                <div className="bg-black rounded-lg shadow h-full p-4 text-green-400 font-mono text-sm">
                    <div>Mosaic Agent Terminal v1.0.0</div>
                    <div>WebSocket terminal integration will be loaded here</div>
                    <div className="mt-4">
                        <span className="text-blue-400">$</span> <span className="animate-pulse">|</span>
                    </div>
                </div>
            </div>
        );
        
        const AgentWorkflowPanel = () => (
            <div className="p-6 h-full">
                <h2 className="text-xl font-bold mb-4">ü§ñ Agent Workflow Manager</h2>
                <div className="bg-white rounded-lg shadow p-6 h-full">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div className="bg-blue-50 p-4 rounded-lg">
                            <h3 className="font-semibold text-blue-800">Active Agents</h3>
                            <p className="text-2xl font-bold text-blue-600">0</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded-lg">
                            <h3 className="font-semibold text-green-800">Workflows</h3>
                            <p className="text-2xl font-bold text-green-600">0</p>
                        </div>
                        <div className="bg-purple-50 p-4 rounded-lg">
                            <h3 className="font-semibold text-purple-800">Tasks</h3>
                            <p className="text-2xl font-bold text-purple-600">0</p>
                        </div>
                    </div>
                    <div className="text-center text-gray-500">
                        Agent orchestration interface will be loaded here
                    </div>
                </div>
            </div>
        );
        
        const SecurityPanel = () => (
            <div className="p-6 h-full">
                <h2 className="text-xl font-bold mb-4">üîí Security & Sandbox</h2>
                <div className="bg-white rounded-lg shadow p-6 h-full">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 className="font-semibold mb-3">Security Features</h3>
                            <ul className="space-y-2 text-sm">
                                <li className="flex items-center">
                                    <span className="text-green-500 mr-2">‚úì</span>
                                    Command validation
                                </li>
                                <li className="flex items-center">
                                    <span className="text-green-500 mr-2">‚úì</span>
                                    Rate limiting
                                </li>
                                <li className="flex items-center">
                                    <span className="text-green-500 mr-2">‚úì</span>
                                    Path traversal protection
                                </li>
                                <li className="flex items-center">
                                    <span className="text-green-500 mr-2">‚úì</span>
                                    File type validation
                                </li>
                                <li className="flex items-center">
                                    <span className="text-yellow-500 mr-2">‚óã</span>
                                    Docker sandbox (optional)
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h3 className="font-semibold mb-3">Rate Limits</h3>
                            <ul className="space-y-2 text-sm text-gray-600">
                                <li>General API: 100/15min</li>
                                <li>File uploads: 10/5min</li>
                                <li>Terminal commands: 30/min</li>
                                <li>Agent operations: 50/10min</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        );
        
        // Render the application
        ReactDOM.render(<MosaicAgentApp />, document.getElementById('root'));
    </script>
</body>
</html>